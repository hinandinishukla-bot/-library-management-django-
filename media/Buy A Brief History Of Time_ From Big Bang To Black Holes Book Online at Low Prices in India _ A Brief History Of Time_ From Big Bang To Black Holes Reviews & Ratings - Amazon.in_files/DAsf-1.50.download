(()=>{let e=(e,t,i)=>(...a)=>{try{e(...a)}catch(e){null==t||t(i||"Error in handler",e)}},t=e=>"V"===e,i=e=>o(e),a=/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$/,n=e=>a.test(e),r=e=>n(e)?i(e):e,l=e=>n(e)?e:s(e),s=e=>btoa(unescape(encodeURIComponent(e))),o=e=>decodeURIComponent(escape(atob(e))),d=e=>e?e.split("&c=${AAX_PAYLOAD}").join(""):e;var c=function(e){console.debug(e)},m=function(e,t){console.error(e,JSON.stringify(t)),u("ERROR",e,p(e,t))},h=function(e,t){console.error(e,JSON.stringify(t)),u("FATAL",e,p(e,t))},u=function(e,t,i){var a;null==(a=window.ueLogError)||a.call(window,i,{logLevel:e,attribution:"APE-safeframe",message:t+" | "})},p=function(e,t){return t instanceof Error?t:t?Error(t):Error(e)};class g{constructor(e={},t={},i={}){this.adMap=e,this.ADS_HANDLERS=t,this.viewableLatencyTrackers=i}}class v{constructor(e){this.adMap=e,this.sendMessageToAd=(e,t,i)=>{this.adMap[e].messagePort.postMessage({command:t,data:i})},this.sendCustomMessageToAd=(e,t,i)=>{this.sendMessageToAd(e,"customMessage",{key:t,data:i})}}}class w{constructor(e,t){this.supportedCommands=e,this.eventsChannel=t,this.receiveMessage=async({data:{command:e,adDetails:t,payload:i}})=>{try{let a={...this.eventsChannel,...this.supportedCommands}[e];a&&await a(t,i)}catch(e){m("Problem with message: "+JSON.stringify(i),e)}}}}let f=e=>e+"_Feedback";class b{async addSponsoredLabelWithFeedbackLink(e,t){e.appendChildTo(this.parentHtmlId,this);let i=await t.getSponsoredLabelAndFeedbackLink(this.urlPathAndParameter);if(!(null==i?void 0:i.isOk()))throw Error(`Result from the feedback service was not ok ${this.urlPathAndParameter}`);e.updateElement(this.getHtmlId(),i)}getHtmlId(){return f(this.parentHtmlId)}isHidden(){return this.hidden}exists(e){return e.exists(this.getHtmlId())}getFeedbackSpanElement(){return document.querySelector(`#${this.getHtmlId()} span`)}constructor(e,t,i,a,n,r,l){this.parentHtmlId=e,this.feedbackStyle=t,this.labelText=i,this.labelStyle=a,this.position=n,this.urlPathAndParameter=r,this.hidden=l}}class y{open(e){e.clickChildLink(this)}getHtmlId(){return f(this.parentHtmlId)}constructor(e){this.parentHtmlId=e}}class I{async createSponsoredLabelWithFeedbackLink(e,t){if(!e.exists(this.feedbackHtmlPort)){t.request();try{await e.addSponsoredLabelWithFeedbackLink(this.feedbackHtmlPort,this.feedbackApiPort),t.success(),e.isHidden()||t.labelRenderedHost()}catch(e){throw t.error(),e}}}openModal(e){e.open(this.feedbackHtmlPort)}labelRendered(e){e.labelRenderedCreative()}logTransparencyInfoMissing(e){e.transparencyInfoMissing()}constructor(e,t){this.feedbackHtmlPort=e,this.feedbackApiPort=t}}var E=/(\/b|\/s|\/l).*(node=)(\d{1,12})/,S=new Map,T=function(){if(!S.has(window.location.href)){var e=E.exec(window.location.href),t=e&&e[3]?e[3]:null;S.set(window.location.href,t)}return S.get(window.location.href)},C=function(e){var t=T();if(!e||!t)return null;var i=e.split(":");return i.splice(i.length-1,0,t),i.join(":")},A=function(e){var t=T();return t?"".concat(e,":").concat(t):null},x=function(e){return e.replace(/_/g,":")},k=function(e,t,i){if(void 0===i&&(i=1),N()){var a=function(e,t,i){t&&D("".concat(_(e),":").concat(t),i)};a(e,t.id,i),a(e,A(t.id),i),a(e,x(t.name),i),a(e,C(x(t.name)),i)}},M=function(e,t){void 0===t&&(t=1),N()&&D(_(e),t)},N=function(){var e;return"function"==typeof(null==(e=null==window?void 0:window.ue)?void 0:e.count)},D=function(e,t){var i;return null==(i=null==window?void 0:window.ue)?void 0:i.count(e,t)},L="adplacements",_=function(e){return e.startsWith(L)?e:"".concat(L,":").concat(e)},R=function(e){if(window.csa)try{window.csa("Events",{producerId:"adplacements"})("setEntity",{adCreativeMetaData:e})}catch(e){m("Error with 'setEntity' CSA",e)}},O=function(e,t,i){if(void 0===i&&(i=1),window.csa)try{window.csa("Events",{producerId:"adplacements"})("log",{schemaId:"ApeSafeframe.csaEvent.1",metricName:e+":"+t.name+":"+t.id,metricValue:i},{ent:"all"})}catch(e){m("Error with 'logCsaEvent' CSA",e)}},F=function(e,t){if(void 0===t&&(t=1),window.csa)try{window.csa("Events",{producerId:"adplacements"})("log",{schemaId:"ApeSafeframe.csaEvent.1",metricName:e,metricValue:t},{ent:"all"})}catch(e){m("Error with 'incrementCounter' CSA",e)}};let B=e=>new U(e),V={REQUEST:"adfeedback_request",SUCCESS:"adfeedback_success",ERROR:"adfeedback_error",LABEL_RENDERED_CREATIVE:"adfeedback_sponsoredlabelrendered_creative",LABEL_RENDERED_HOST:"adfeedback_sponsoredlabelrendered_host"},H={REQUEST:"adfeedback:request",SUCCESS:"adfeedback:success",ERROR:"adfeedback:error",LABEL_RENDERED_CREATIVE:"adfeedback:sponsoredlabelrendered:creative",LABEL_RENDERED_HOST:"adfeedback:sponsoredlabelrendered:host",LABEL_RENDERED:"adfeedback:sponsoredlabelrendered",TRANSPARENCY_INFO_MISSING:"adfeedback:transparencyinfo:missing"};class U{request(){k(H.REQUEST,this.placement),M(H.REQUEST),O(V.REQUEST,this.placement)}success(){k(H.SUCCESS,this.placement),M(H.SUCCESS),O(V.SUCCESS,this.placement)}error(){k(H.ERROR,this.placement),O(V.ERROR,this.placement)}labelRenderedCreative(){k(H.LABEL_RENDERED_CREATIVE,this.placement),M(H.LABEL_RENDERED),O(V.LABEL_RENDERED_CREATIVE,this.placement)}labelRenderedHost(){k(H.LABEL_RENDERED_HOST,this.placement),M(H.LABEL_RENDERED),O(V.LABEL_RENDERED_HOST,this.placement)}transparencyInfoMissing(){k(H.TRANSPARENCY_INFO_MISSING,this.placement),M(H.TRANSPARENCY_INFO_MISSING)}constructor(e){this.placement=e}}class ${isOk(){return"ok"===this.status}constructor(e,t,i){this.status=e,this.html=t,this.script=i}}class z{async getSponsoredLabelAndFeedbackLink(e){let t=await window.fetch(this.windowRepo.origin()+e);if(t.ok){let e=await t.json();return new $(e.status,e.html,e.script)}throw Error("Could not fetch the feedback html/link/script/label")}constructor(e){this.windowRepo=e}}class W{appendChildTo(e,t){var i,a;function n(e,t){let i=document.createElement("div");return i.setAttribute("id",t.getHtmlId()),i.classList.add("ape-feedback"),i.style.position="relative",i.style.height="auto",i.style.minHeight="20px",i.style.textAlign=i.id.includes("hero-quick-promo_Desktop_placement_Feedback")?"left":"right",i.style.padding="0",i.style.marginTop="2px",i.style.display=t.feedbackStyle.display,e.endsWith("_wrapper")&&(e.includes("-ilm")||(i.style.maxWidth="min(100vh, 100vw)"),i.style.marginLeft="auto",i.style.marginRight="auto",i.style.padding="0 5px"),i.append(function(e){let t=document.createElement("div");return t.innerHTML=e.labelText,J(t,e.labelStyle),t}(t)),i}1===t.position?null==(i=document.getElementById(e))||i.prepend(n(e,t)):0===t.position&&(null==(a=document.getElementById(e))||a.append(n(e,t)))}updateElement(e,t){let i=document.getElementById(e);if(i)for(let e of(i.innerHTML=t.html,G(i,t),i.children))"DIV"===e.tagName?e.removeAttribute("style"):"A"===e.tagName&&(e.style.removeProperty("position"),e.style.removeProperty("top"),e.style.removeProperty("right"),e.style.removeProperty("display"))}clickChildLink(e){let t=document.getElementById(e.getHtmlId());for(let e of(null==t?void 0:t.children)||[]){var i;if("A"===(i=e).tagName||"DIV"===i.tagName)return void e.click()}}exists(e){return!!document.getElementById(e)}}let J=(e,t)=>{for(let i in t)e.style.setProperty(i,t[i])},G=(e,t)=>{q(e).innerHTML=t.script},q=e=>{let t=document.createElement("script");return e.prepend(t),t},K={code:"BE",hostname:"www.amazon.com.be",name:"Belgium"},Y={code:"FR",hostname:"www.amazon.fr",name:"France"},X={code:"DE",hostname:"www.amazon.de",name:"Germany"},j={code:"IT",hostname:"www.amazon.it",name:"Italy"},Z={code:"NL",hostname:"www.amazon.nl",name:"Netherlands"},Q={code:"PL",hostname:"www.amazon.pl",name:"Poland"},ee={code:"ES",hostname:"www.amazon.es",name:"Spain"},et={code:"SE",hostname:"www.amazon.se",name:"Sweden"},ei=e=>location.hostname===e.hostname,ea=()=>ei(K)||ei(Y)||ei(X)||ei(j)||ei(Z)||ei(Q)||ei(ee)||ei(et),en=e=>!ea()||er(e),er=e=>{var t,i,a,n,r,l;let s=[];es(null==e||null==(a=e.url)||null==(i=a.parameters)||null==(t=i.adPlacementMetaData)?void 0:t.slotName)&&s.push("DSA Error: slotName missing");let o=null==e||null==(l=e.url)||null==(r=l.parameters)||null==(n=r.adCreativeMetaData)?void 0:n.adCreativeDetails;for(let e of((!o||o.length<=0)&&s.push("DSA Error: transparency info missing"),null==o||o.every(e=>el(e,s)),s))m(e);return s.length<=0},el=(e,t)=>{var i,a,n,r,l;e.version||t.push("DSA Error: version missing"),es(e.advertiserIdNS)&&t.push("DSA Error: advertiserIdNS missing"),((null==(i=e.selectionSignals)?void 0:i.context)===void 0||(null==(a=e.selectionSignals)?void 0:a.context)===null)&&t.push("DSA Error: selectionSignals.context missing"),((null==(n=e.selectionSignals)?void 0:n.location)===void 0||(null==(r=e.selectionSignals)?void 0:r.location)===null)&&t.push("DSA Error: selectionSignals.location missing"),es(null==(l=e.selectionSignals)?void 0:l.pastActivity)&&t.push("DSA Error: selectionSignals.pastActivity missing")},es=e=>!(null==e?void 0:e.trim()),eo=()=>new ed(new I(new W,new z({origin:()=>window.location.origin})));class ed{async addSponsoredLabel({parentHtmlId:e,placement:t,feedback:i}){return en(i)?(i.hidden&&(Object.assign(i.style,{display:"none"}),Object.assign(i.label.style,{display:"none"})),await this.feedbackService.createSponsoredLabelWithFeedbackLink(em(e,i),B(t)),!0):(this.feedbackService.logTransparencyInfoMissing(B(t)),m("Transparency Information missing"),!1)}openModal(e){this.feedbackService.openModal(new y(e))}labelRendered({placement:e}){this.feedbackService.labelRendered(B(e))}constructor(e){this.feedbackService=e}}let ec=e=>"/af/feedback-link?pl="+e,em=(e,t)=>{let i=JSON.parse(JSON.stringify(t.url.parameters));return i.adPlacementMetaData.pageUrl=l(i.adPlacementMetaData.pageUrl),new b(e,t.style,t.label.text,t.label.style,+("TOP"===t.position),ec(encodeURIComponent(JSON.stringify(i))),t.hidden)},eh=e=>{eo().labelRendered({placement:{id:e.placementId,name:e.placementName}})},eu=e=>{var t;eo().openModal(null!=(t=e.adUnitWrapperId)?t:e.adUnitPlacementId)},ep=async e=>{if(!await eo().addSponsoredLabel(eg(e)))throw Error("Failed to create sponsored label and feedback link")},eg=e=>{var t;let i=e.adPlacementMetaData,a=e.adFeedbackInfo;return{parentHtmlId:null!=(t=e.adUnitWrapperId)?t:e.adUnitPlacementId,placement:{id:e.placementId,name:e.placementName},feedback:{position:"BOTTOM",hidden:!a.boolFeedback,style:e.feedbackDivStyle,url:{parameters:{adPlacementMetaData:{adElementId:i.adElementId,pageType:i.pageType,pageUrl:l(i.pageUrl),slotName:i.slotName},adCreativeMetaData:e.adCreativeMetaData}},label:{text:r(a.sponsoredText),style:e.advertisementStyle}}}},ev=(e,t)=>{let i=()=>{var i,a;return null==e||null==(a=e.renderingWeblabs)||null==(i=a[t])?void 0:i.toLowerCase()};return{isT1:()=>"t1"===i(),isT2:()=>"t2"===i(),getTreatment:()=>i()}},ew=()=>ev(window,"ADPT_SF_LOW_RATE_METRIC_LOGGING_1256362"),ef=()=>ev(window,"ADPT_SF_HIGH_RATE_METRIC_LOGGING_1256364"),eb=()=>ev(window,"APM_STORES_JPS_JRS_SAFEFRAME_H1_SAFEZONE_1279523"),ey=()=>ev(window,"ADPT_SF_SERVER_SIDE_SPONSORED_LABEL_998980"),eI=()=>ev(window,"APM_STORES_JPS_JRS_SAFEFRAME_VIEW_RATE_EXPERIMENT_1289633"),eE=()=>ev(window,"APM_STORES_JPS_JRS_CREATIVE_BOOKS_ADS_1277965"),eS=()=>ev(window,"APM_STORES_JPS_JRS_SAFEFRAME_1318775"),eP="APE_CW_METRICS",eT=!1,eC=e=>{eT||(window.addEventListener("beforeunload",()=>eN()),eT=!0);let t=eA();t.push(e),t.length>=10?ex(t):eM(t)},eA=()=>{let e=localStorage.getItem(eP);if(!e)return[];try{return JSON.parse(e)}catch(e){return[]}},ex=e=>{navigator.sendBeacon("https://qdbx3pbnx6veby23pzgaowu3q40tmmrr.lambda-url.us-east-1.on.aws",JSON.stringify(ek(e))),localStorage.removeItem(eP)},ek=e=>({metrics:e,xApiKey:"aUAZqFtiIp6VxqpW3coqZ2JdZnV3RN9S8yKMRIdJ"}),eM=e=>{localStorage.setItem(eP,JSON.stringify(e))},eN=()=>{let e=eA();e.length>0&&ex(e)},eD=e=>{var t,i;if(!window.APE_SF)return;let a=null!=(i=(t=window.APE_SF).loggedMetricNames)?i:t.loggedMetricNames=new Set;a.has(e.metricName)||(a.add(e.metricName),eC(e))},eL=({metricName:e,adDetails:t,count:i=1,additionalDimensions:a={}})=>{ef().isT1()&&eC(eR(e,i,eO(t,a)))},e_=({metricName:e,adDetails:t,count:i=1,additionalDimensions:a={},once:n=!1})=>{ew().isT1()&&(n?eD:eC)(eR(e,i,eO(t,a)))},eR=(e,t,i)=>({metricName:e,timestamp:new Date().getTime(),value:t,dimensions:i}),eO=(e,t)=>{var i,a;return{app:"SF",siteName:e.siteName,slotName:e.slotName,pageType:e.pageType,placementId:e.placementId,mediaType:e.mediaType,programId:null==(i=e.adCreativeMetaData)?void 0:i.adProgramId,creativeTemplateName:null==(a=e.adCreativeMetaData)?void 0:a.adCreativeTemplateName,deviceType:e.deviceType,...t}};class eF{collapse(e,t){this.wrapperDiv&&(this.wrapperDiv.style.display="none"),this.div.style.display="none",eL({metricName:"placement:collapse",adDetails:e,additionalDimensions:{code:t,isBlank:`${eB(e)}`,creativeId:e.adCreativeMetaData.adCreativeId}})}get wrapperDiv(){return this.wrapperDivId?document.getElementById(this.wrapperDivId):null}get div(){return document.getElementById(this.divId)}constructor(e,t,i,a){this.id=e,this.name=t,this.wrapperDivId=i,this.divId=a}}let eB=e=>{let t=e.htmlContentEncoded.match(/<div id="ad">\s*(.*?)\s*<\/div>/s);return!!t&&""===t[1].trim()},eV=e=>new eF(e.placementId,e.placementName,e.adUnitWrapperId,e.adUnitPlacementId),eH=()=>window.innerHeight||document.documentElement.clientHeight,eU=()=>window.innerWidth||document.documentElement.clientWidth,e$=e=>e.getBoundingClientRect().top-eH(),ez=(e,t)=>({t:e.top,l:e.left,r:e.right,b:e.bottom,w:e.width,h:e.height,z:t}),eW=e=>ez(e.getBoundingClientRect(),Number(window.getComputedStyle(e,null).zIndex)),eJ=e=>{let t=function(e){let t=document.body.getBoundingClientRect();if(eG(t))return null;let i=eW(e),a=eH(),n=eU();return Number(Math.min(1,Math.max(0,Math.max(0,Math.min(t.left+n,i.r)-i.l)*Math.max(0,Math.min(t.top+a,i.b)-i.t)/(i.h*Math.min(i.w,n)))).toFixed(2))}(e);return null==t?"unknown":t>=.5},eG=e=>0===e.width&&0===e.height,eq=(e,t)=>{let i=eW(e),a=eW(t),n=eU(),r=eH();return i&&a&&(Math.abs(i.t-a.b)<r||Math.abs(i.b-a.t)<r)&&(Math.abs(i.l-a.r)<n||Math.abs(i.r-a.l)<n)};function eK(e,t,i){var a,n=i||{},r=n.noTrailing,l=void 0!==r&&r,s=n.noLeading,o=void 0!==s&&s,d=n.debounceMode,c=void 0===d?void 0:d,m=!1,h=0;function u(){a&&clearTimeout(a)}function p(){for(var i=arguments.length,n=Array(i),r=0;r<i;r++)n[r]=arguments[r];var s=this,d=Date.now()-h;function p(){h=Date.now(),t.apply(s,n)}function g(){a=void 0}!m&&(o||!c||a||p(),u(),void 0===c&&d>e?o?(h=Date.now(),l||(a=setTimeout(c?g:p,e))):p():!0!==l&&(a=setTimeout(c?g:p,void 0===c?e-d:e)))}return p.cancel=function(e){var t=(e||{}).upcomingOnly;u(),m=!(void 0!==t&&t)},p}let eY=e=>{window.addEventListener("scroll",e),window.addEventListener("resize",e),document.addEventListener("visibilitychange",e)},eX=e=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",e),document.removeEventListener("visibilitychange",e)};var ej={wb:"ues",bb:"uet",af:"uet",cf:"uet",be:"uet",ld:"uex"},eZ=function(e){var t,i,a=e.latencyEvent,n=e.scope,r=e.placement,l=e.timestamp;eQ(a)&&(e0(a,e1(n),r.id,l),e0(a,e1(n),x(r.name),l),e0(a,e1(n),null!=(t=C(r.name))?t:void 0,l),e0(a,e1(n),null!=(i=A(r.id))?i:void 0,l))},eQ=function(e){return"function"==typeof window[ej[e]]},e0=function(e,t,i,a){void 0===a&&(a=new Date);var n=ej[e];i&&"function"==typeof window[n]&&window[n](e,t+i,{wb:1},a)},e1=function(e){return"adplacements:"+e2(e)},e2=function(e){return e?"".concat(e,":"):""},e3=function(e,t,i){if(window.csa)try{window.csa("Content",{element:e})("mark",t,null==i?void 0:i.getTime())}catch(e){m("Error with 'mark' CSA",e)}};class e5{sendLatencyMetric({latencyMetricType:e,placementId:t,placementName:i,placementDivId:a,timestamp:n}){eZ({latencyEvent:e.csmKey,scope:e.csmMessage,placement:{id:t,name:i},timestamp:n}),e3(document.getElementById(a),e.csaKey,n)}}let e9=()=>new e5,e6="sfImpression",e4="LightAdImpression",e7="viewablelatency",e8=(e,t,i)=>({csaKey:e,csmKey:t,csmMessage:i}),te=e8("bodyBegin","bb"),tt=e8("bodyBegin","bb",e6);e8("bodyBegin","bb",e4),e8("bodyEnd","be"),e8("clickToATF","af"),e8("criticalFeature","cf"),e8("criticalFeature","cf",e6),e8("criticalFeature","cf",e4),e8("loaded","ld"),e8("loaded","ld",e6),e8("loaded","ld",e4);let ti=e8("viewablelatency:bodyBegin","bb",e7),ta=e8("viewablelatency:loaded","ld",e7),tn=(e,t,i)=>e>0?i>e:t>0,tr=(e,t,i,a,n,r)=>{var l,s,o;let d=null==(o=document)||null==(s=o.getElementById)||null==(l=s.call(o,i))?void 0:l.getBoundingClientRect();if(d&&tn(d.top,d.bottom,eH())&&tn(d.left,d.right,eU())){if(e9().sendLatencyMetric({latencyMetricType:ti,placementId:n,placementName:a,placementDivId:i,timestamp:new Date}),e[r].loaded){e9().sendLatencyMetric({latencyMetricType:ta,placementId:n,placementName:a,placementDivId:i,timestamp:new Date});let e={id:n,name:a};k("adplacements:htmlviewed:loaded:",e),k("adplacements:htmlviewed",e)}t.viewed=!0,eX(t.tracker)}},tl=(t,i)=>{if(!t[i.arid]){t[i.arid]={valid:!1};try{let a=t[i.arid];tr(t,a,i.adUnitPlacementId,i.placementName,i.placementId,i.arid);let n=e(eK(20,()=>{tr(t,a,i.adUnitPlacementId,i.placementName,i.placementId,i.arid)}),m);eY(n),a.tracker=n,a.valid=!0}catch(e){throw m("Error initializing viewable latency instrumentation",e),e}}},ts=e=>{try{k("coordinate:x",e,e.div.getBoundingClientRect().x),k("coordinate:y",e,e.div.getBoundingClientRect().y)}catch(e){return}},to=(e,t,i)=>{e9().sendLatencyMetric({latencyMetricType:tt,placementId:e.placementId,placementName:e.placementName,placementDivId:e.adUnitPlacementId}),i&&(e9().sendLatencyMetric({latencyMetricType:te,placementId:e.placementId,placementName:e.placementName,placementDivId:e.adUnitPlacementId,timestamp:i}),eZ({latencyEvent:"wb",placement:t,timestamp:i})),k("adload:start",t),O("adload_start",t),k("adload:delayloadcallback",t),O("adload_delayload",t)},td=/AdPlacementStyleAssets|apePlacements/,tc=e=>{let t=performance.getEntriesByType("resource").find(e=>{var t;return null==(t=e.name.match(td))?void 0:t[0]});if(t){var i;let a=null==(i=t.name.match(td))?void 0:i[0];e_({metricName:"asset:load:timing",adDetails:e,additionalDimensions:{...a&&{assetName:a},assetUrl:t.name,dns:String(t.domainLookupEnd-t.domainLookupStart),tcp:String(t.connectEnd-t.connectStart),ttfb:String(t.responseStart-t.requestStart),download:String(t.responseEnd-t.responseStart),total:String(t.responseEnd-t.startTime)},once:!0})}};class tm{constructor(e,t){this.hc=e,this.hmr=t,this.collapsedPlacements=new Set,this.initializeAdMap=(e,t)=>{try{this.hc.adMap[e.arid]={messagePort:t}}catch(t){m(`Error creating safeFrame ${e.slotName}`,t)}},this.secondPhaseLoadAd=async(e,t,i,a)=>{await this.setupMessageChannel(i,t,a)},this.setupMessageChannel=async(e,t,i)=>{var a,n;null==(n=performance)||null==(a=n.mark)||a.call(n,`SafeFrame: Start setupMessagePort ${t.adUnitPlacementId}`),this.initializeAdMap(t,e);let r=this.hc;r.ADS_HANDLERS[t.arid]=r.ADS_HANDLERS[t.arid]||{};let l=eV(t);ts(l),to(t,l,i),tc(t),tl(r.viewableLatencyTrackers,t);try{ey().isT1()||await ep(t),th(r,t,this.hmr)}catch(e){throw l.collapse(t,"HOSTSETUP"),e}}}}let th=(e,t,i)=>{e.adMap[t.arid].messagePort.onmessage=i.receiveMessage},tu="cod_client",tp=async(e,t)=>{if(e&&e.trim().match(/^\d{1,4}px$/g))return await tg(parseInt(e,10),t,(e,t)=>{let i=e$(e);return e&&i<=t})},tg=async(t,i,a)=>new Promise(n=>{let r=()=>{a(i,t)&&(n(),window.removeEventListener("scroll",l),window.removeEventListener("resize",l))},l=e(eK(20,()=>{r()}),m);window.addEventListener("scroll",l),window.addEventListener("resize",l),r()}),tv=(e,t,i,a,n,r)=>{let l=null==e?void 0:e[t];(null==l?void 0:l.valid)&&(l.loaded=!0,l.viewed&&(e9().sendLatencyMetric({latencyMetricType:ta,placementId:a,placementName:i,placementDivId:n,timestamp:new Date(r)}),k("htmlviewed:loaded",{id:a,name:i})))},tw=async(e,t)=>{let i,a;return new Promise(n=>{a=n,(i=new IntersectionObserver(t=>{t.forEach(t=>{t.target===e&&t.isIntersecting&&(a(t),i.unobserve(e))})},t)).observe(e)})},tf=e=>{let{adUnitIframeId:t}=e,i=document.getElementById(t);if(!i){let{readyState:i}=document;M("getiframe:undefined"),e_({metricName:"html:element:missing:iframe",adDetails:e,additionalDimensions:{readyState:i,adUnitIframeId:t}})}return i},tb=async e=>{let t=tf(e),i={root:ty(t)?null:document.documentElement};await tw(t,i)},ty=e=>{let t=e;for(;t;){if("fixed"===window.getComputedStyle(t,null).getPropertyValue("position"))return!0;t=t.parentElement}return!1},tI=e=>{let t=document.getElementById(e.adUnitPlacementId);return t||(M("getplacement:undefined"),e_({metricName:"html:element:missing:placement",adDetails:e})),t},tE=async(e,t)=>{t.firePixelsAfter&&await tp(t.firePixelsAfter,tI(t)),await tb(t),e.sendMessageToAd(t.arid,"fireImpression",{measurementMethod:tu,isNoInventory:!1})},tS="gw-video-orchestrator",tP=(e,t,i)=>{var a;null==(a=window.P)||a.when(tS).execute(a=>{try{a.subscribe(e,t,i)}catch(e){c(`gw-video-orchestrator error: ${JSON.stringify(e)}`)}})},tT=e=>tA(e),tC=()=>tA(),tA=e=>{var t;null==(t=window.P)||t.when(tS).execute(t=>{t.elect(e)})},tx=null,tk=(e,t,i)=>{let a=t=>i.sendCustomMessageToAd(e.arid,"videoAutoplayResponse",t);tD(e.pageType)?tP(tf(e),a,t):tx===e.arid?a(!0):null===tx&&tL(tf(e))?(tx=e.arid,a(!0)):a(!1)},tM=()=>{tC(),tx=null},tN=e=>{tT(tf(e)),tx=e.arid},tD=e=>(null==e?void 0:e.toLowerCase())==="gateway",tL=e=>![...document.getElementsByTagName("video")].some(t=>!t.paused&&eq(e,t));class t_{async fire(e,t={}){this.isFired||(await fetch(this.urlGenerator.generateUrl(this.url,e),{keepalive:!0,mode:"no-cors",...t}),e.div.appendChild(this.pixel(e)),this.isFired=!0,this.logOnFirePixel(this.loggingContext,e))}logOnFirePixel(e,t){var i;M(`pixel:${this.logId}`),k(`pixel:${this.logId}`,t),M(`pixel:${this.logId}:${e.aaxProgramId}`),M(`pixel:${this.logId}:device:${null==(i=t.deviceType)?void 0:i.toLowerCase()}`)}constructor(e,t,i){this.url=e,this.loggingContext=t,this.urlGenerator=i,this.isFired=!1,this.pixel=e=>{let t=document.createElement("img");return t.id=`${this.pixelId}_${e.name}`,t.style.display="none",t.setAttribute("pixel-url",this.urlGenerator.generateUrl(this.url,e)),t}}}let tR=(e,t,i)=>{if(""===t)throw Error("Invalid queryParamKey input to addJSONQueryParamToURL: "+JSON.stringify({queryParamKey:t}));let a=new URL(e),n=Object.assign(JSON.parse(a.searchParams.get(t)||"{}"),i);return a.searchParams.set(t,JSON.stringify(n)),a.toString()},tO=/\${AAX_TYPE}/,tF=/\${AAX_PAYLOAD}/,tB=()=>({generateUrl(e){let t=e.includes(".paets.");return tR(e,"pj",t?{}:{measurementMethod:tu})}});class tV extends t_{constructor(e,t){super(e,t,tB()),this.pixelId="ape_impression",this.logId="imp:cod"}}let tH=()=>({generateUrl(e,t){let i=JSON.stringify({atf:eJ(t.div)});return tO.test(e)?e.replace(tO,"atf").replace(tF,i):`${e.replace(/\/$/,"")}/atf/${i}`}});class tU extends t_{constructor(e,t){super(e,t,tH()),this.pixelId="ape_measurability",this.logId="imp:atf"}}let t$="AppAdsMshopIOSPlugin",tz=e=>{var t;null==(t=window.P)||t.when(t$).execute(t=>{t.startAttributeViewThroughAppAds({skAdNetwork:e})})},tW=e=>{var t;null==(t=window.P)||t.when(t$).execute(t=>{t.endAttributeViewThroughAppAds({skAdNetwork:e})})};class tJ extends t_{async fire(e){this.isFired||(tz(this.skAdNetwork),this.isFired=!0,this.logOnFirePixel(this.loggingContext,e))}constructor(e,t,i){super(e,t,tB()),this.skAdNetwork=i,this.pixelId="ape_impression",this.logId="imp:skan"}}let tG=(e,t)=>{let i=tK(t),a=0;for(let[t,n]of i){if(!tY(t,n))continue;let i=document.elementFromPoint(t,n);i&&tq(i,e)&&a++}return a/i.length},tq=(e,t)=>{if(!(e instanceof HTMLElement)||e===t||t.contains(e))return!1;let i=window.getComputedStyle(e);if("none"===i.display||"hidden"===i.visibility||"none"===i.pointerEvents||.7>parseFloat(i.opacity))return!1;let a=i.backgroundColor;return!("transparent"===a||/,0\)$/.test(a))&&""!==a||!!i.backgroundImage.includes("url")},tK=e=>{let t=[];for(let i=0;i<10;i++)t.push([e.left+e.width/2,e.top+e.height*(i+.5)/10]);return t},tY=(e,t)=>{let i=window.innerWidth||document.documentElement.clientWidth,a=window.innerHeight||document.documentElement.clientHeight;return e>=0&&e<=i&&t>=0&&t<=a},tX=e=>{let t=window.innerHeight||document.documentElement.clientHeight,i=window.innerWidth||document.documentElement.clientWidth,a={top:Math.max(0,e.top),left:Math.max(0,e.left),bottom:Math.min(t,e.bottom),right:Math.min(i,e.right)};if(e.top>=t||e.left>=i||e.bottom<=0||e.right<=0||e.width<=0||e.height<=0)return 0;let n=(a.right-a.left)*(a.bottom-a.top);return n/(e.width*e.height)},tj=(e,t)=>{let i=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left)),a=Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return 0===i||0===a?0:i*a/(e.width*e.height)},tZ=e=>{let{height:t,top:i,left:a=0,width:n=eU()}=e;return{top:i,bottom:i+t,left:a,right:a+n,width:n,height:t}},tQ=e=>(null==e?void 0:e.toLowerCase())==="mshop",t0=e=>{var t;let i=e.placement.div.getBoundingClientRect();return{v:{def:e.definition,p:e.thresholdPercentage,t:e.thresholdTimeVisibleMs,ib:e.isBtr},wh:window.innerHeight||document.documentElement.clientHeight,ww:window.innerWidth||document.documentElement.clientWidth,sx:window.scrollX,sy:window.scrollY,ah:i.height,aw:i.width,top:i.top,left:i.left,ptv:(new Date().getTime()-(null!=(t=window.aPageStart)?t:0))/1e3,ttv:(new Date().getTime()-e.adStartTime)/1e3}},t1=e=>tQ(e.deviceType)?"viewPixel:iab:mshop:fired":"viewPixel:iab:fired",t2=e=>{let t=e.name.toLowerCase();return t.includes("h1")||t.includes("wd-1")};class t3 extends t_{postPixelFireCleanup(e,t){e.unobserve(t.div),clearTimeout(this.viewTimerTimeoutId),clearInterval(this.obstructionCheckIntervalId),this.visibilityChangeService.removeVisibilityChangeDetection(),this.emitObstructionRecoveryMetrics(t),this.viewabilityService.removeNativeObstructionsChangedListener()}postPlacementExitsViewportCleanup(){clearTimeout(this.viewTimerTimeoutId),clearTimeout(this.legacyViewTimerTimeoutId),clearInterval(this.obstructionCheckIntervalId),clearInterval(this.shouldFirePixelIntervalId),this.visibilityChangeService.removeVisibilityChangeDetection()}fireInObserver(e,t){this.fire(t),this.postPixelFireCleanup(e,t)}startInViewTimer(e,t){this.viewTimerTimeoutId=setTimeout(()=>this.fireInObserver(e,t),this.viewabilityStandard.thresholdTimeVisibleMs),this.isIab()&&this.performContinuousObstructionCheck(e,t),this.visibilityChangeService.setupVisibilityChangeDetection(this.viewTimerTimeoutId,e,t)}startLegacyInViewTimer(e){this.legacyViewTimerTimeoutId=setTimeout(()=>this.emitLegacyFiredViewMetric(e),this.viewabilityStandard.thresholdTimeVisibleMs)}performContinuousObstructionCheck(e,t){this.obstructionCheckIntervalId=setInterval(()=>{try{this.viewabilityService.isViewabilityObstructed(t,this.viewabilityStandard.thresholdPercentage)&&(this.wasObstructed=!0,clearTimeout(this.viewTimerTimeoutId),clearInterval(this.obstructionCheckIntervalId),this.startInViewTimer(e,t))}catch(e){h(null==e?void 0:e.message,e),clearInterval(this.obstructionCheckIntervalId)}},100)}track(e){new IntersectionObserver((t,i)=>{t.forEach(t=>{t.isIntersecting?this.viewabilityStandard.thresholdTimeVisibleMs>0?(this.startInViewTimer(i,e),this.startLegacyInViewTimer(e)):this.fireInObserver(i,e):this.postPlacementExitsViewportCleanup()})},{threshold:this.viewabilityStandard.thresholdPercentage}).observe(e.div)}async fire(e){this.videoPixelValidator&&!this.videoPixelValidator.shouldFirePixel()&&await this.waitUntilShouldFirePixel(),super.fire(e)}waitUntilShouldFirePixel(){return new Promise(e=>{this.shouldFirePixelIntervalId=setInterval(()=>{this.videoPixelValidator&&this.videoPixelValidator.shouldFirePixel()&&(clearInterval(this.shouldFirePixelIntervalId),e())},100)})}get pixelId(){return`ape_viewability_${this.viewabilityStandard.definition}`}constructor(e,t,i,a,n,r,l){super(e,t,r),this.viewabilityStandard=i,this.visibilityChangeService=a,this.viewabilityService=n,this.videoPixelValidator=l,this.metricsLogged=new Set,this.wasObstructed=!1,this.emitObstructionRecoveryMetrics=e=>{this.wasObstructed&&this.logMetrics("viewpixel:iab:obstruction:recovered",1,e)},this.emitLegacyFiredViewMetric=e=>{let t=t1(e);this.logMetrics(t,1,e),clearTimeout(this.legacyViewTimerTimeoutId)},this.logMetrics=(e,t=1,i)=>{!this.metricsLogged.has(e)&&this.isIab()&&(M(e,t),F(e,t),i&&(k(e,i,t),O(e,i,t)),this.metricsLogged.add(e))},this.isIab=()=>"iab"===this.viewabilityStandard.definition,this.logId=`view:${this.viewabilityStandard.definition}`}}let t5=()=>({generateUrl(){throw Error("PixelUrl should not be used for this pixel type")}});class t9 extends t3{get pixelId(){return"skan_view_pixel"}async fire(e){this.isFired||(tW(this.skAdNetwork),this.isFired=!0,this.logOnFirePixel(this.loggingContext,e))}constructor(e,t,i,a,n,r,l){super(e,t,a,n,r,t5(),l),this.skAdNetwork=i,this.logId="view:skan"}}let t6=()=>({generateUrl:e=>tR(d(e),"c",{measurementMethod:"btr_client"})});class t4 extends t_{constructor(e,t){super(e,t,t6()),this.pixelId="ape_btr_impression",this.logId="imp:btr"}}let t7={H1_DESKTOP_HEIGHT:240,H1_DESKTOP_WIDTH:940},t8=e=>{if(ie(e)){let t={height:t7.H1_DESKTOP_HEIGHT,width:t7.H1_DESKTOP_WIDTH};return it(e.div,t)}return e.div.getBoundingClientRect()},ie=e=>"gateway_desktop-h1_desktop"===e.name.toLowerCase(),it=(e,t)=>{let i=e.getBoundingClientRect();return new DOMRect((i.left+i.right)/2-t.width/2,i.y,t.width,t.height)},ii=e=>{let t=new Set,i=(e,i=1,a)=>{t.has(e)||(M(e,i),F(e,i),a&&(k(e,a,i),O(e,a,i)),t.add(e))},a=(e,t)=>{i("viewpixel:iab:obstruction",1,e),i(ia(t),1,e),"Native"===t&&i("viewPixel:iab:obstruction:native:y:top",e.div.getBoundingClientRect().top,e)},n=(t,i,n,r)=>{let l=i-e.getDOMObstructionPercentage(t.div,r)<n;return l&&a(t,"DOM"),l},r=(t,i,n,r)=>{if(tQ(t.deviceType)){let l=i-e.getNativeObstructionPercentage(r)<n;return l&&a(t,"Native"),l}return!1};return{isViewabilityObstructed(e,t){if(eb().isT1()&&t2(e))return!1;let i=t8(e),a=tX(i);return n(e,a,t,i)||r(e,a,t,i)},removeNativeObstructionsChangedListener(){e.removeNativeObstructionsChangedListener()}}},ia=e=>"DOM"===e?"viewPixel:iab:obstruction:UXElement":"viewPixel:iab:obstruction:native",ir="mash",il=async e=>new Promise((t,i)=>{if(!P)return void i(Error("mash:getobstructions:missing"));let a=setTimeout(()=>{i(Error("mash:getobstructions:timeout"))},e),n=performance.now();P.when(ir).execute(e=>{var r,l;if(!(null==e||null==(l=e.appCX)||null==(r=l.uiOrchestrator)?void 0:r.getObstructions)){clearTimeout(a),i(Error("mash:getobstructions:missing"));return}e.appCX.uiOrchestrator.getObstructions({successCallback:e=>{clearTimeout(a),t({boundingBoxes:(e.boundingBoxes||[]).map(tZ),isFullyObstructed:e.isFullyObstructed,latencyMs:performance.now()-n})},failCallback:()=>{clearTimeout(a),i(Error("mash:getobstructions:failure"))}})})}),is=e=>{if(!P)return void M("mash:missing",1);P.when(ir).execute(t=>{null==t||t.addEventListener("obstructionsChanged",e)})},io=e=>{if(!P)return void M("mash:missing",1);P.when(ir).execute(t=>{null==t||t.removeEventListener("obstructionsChanged",e)})},id=e=>e.filter(e=>16!==Math.round(e.height)||0!==e.top),ic=()=>{let e=[],t=!1,i=new Set,a=(e,t=1)=>{i.has(e)||(M(e,t),F(e,t),i.add(e))},n=t=>{var i;e=((null==t||null==(i=t.detail)?void 0:i.boundingBoxes)||[]).map(tZ)},r=e=>{if(e.isFullyObstructed)return a("viewPixel:iab:obstruction:native:fullviewport",1),[tZ({height:window.innerHeight,top:0})];let t=id(e.boundingBoxes);return s(e.boundingBoxes,t),t.map(tZ)};(async()=>{try{e=[],t||(is(n),t=!0);let i=await il(950);e=r(i)}catch(e){a(e.message)}})();let l=t=>0===e.length?0:e.reduce((e,i)=>e+tj(t,i),0),s=(e,t)=>{let i=e.length-t.length;for(let e of(i>0&&a("mash:getobstructions:filtered:count",i),t))a("mash:getobstructions:response:height",e.height),a("mash:getobstructions:response:top",e.top)};return{getNativeObstructionPercentage:e=>l(e),getDOMObstructionPercentage:(e,t)=>tG(e,t),removeNativeObstructionsChangedListener(){t&&io(n)}}},im=()=>{let e=(e,t,i)=>{document.hidden?(clearTimeout(e),t.unobserve(i.div)):t.observe(i.div)};return{removeVisibilityChangeDetection(){this.activeVisChangeHandler&&(document.removeEventListener("visibilitychange",this.activeVisChangeHandler),this.activeVisChangeHandler=void 0)},setupVisibilityChangeDetection(t,i,a){this.removeVisibilityChangeDetection(),this.activeVisChangeHandler=()=>e(t,i,a),document.addEventListener("visibilitychange",this.activeVisChangeHandler)}}},ih={IAB_VIDEO:{definition:"iab",thresholdPercentage:.5,thresholdTimeVisibleMs:2e3},IAB_LARGE_DISPLAY:{definition:"iab",thresholdPercentage:.3,thresholdTimeVisibleMs:1e3},IAB_DISPLAY:{definition:"iab",thresholdPercentage:.5,thresholdTimeVisibleMs:1e3},SKAN:{definition:"skan",thresholdPercentage:.5,thresholdTimeVisibleMs:2e3}},iu={set:(e,t)=>{e.div.dataset.isBtr=String(t)},get:e=>e.div.dataset.isBtr===String(!0)},ip=e=>{let t=new Date().getTime();return{generateUrl(i,a){let n=JSON.stringify(t0({placement:a,definition:e.definition,thresholdPercentage:e.thresholdPercentage,thresholdTimeVisibleMs:e.thresholdTimeVisibleMs,isBtr:iu.get(a),adStartTime:t}));return tO.test(i)?i.replace(tO,"v").replace(tF,n):`${i.replace(/\/+$/,"")}/v/${n}`}}},ig=e=>e.btrPixelUrl?new t4(e.btrPixelUrl,e.loggingContext):void 0,iv=e=>new tV(e.aaxImpPixelUrl,e.loggingContext),iw=e=>new tU(e.aaxInstrPixelUrl,e.loggingContext),ib=(e,t,i,a,n)=>{let r=ii(ic());if("V"===e){if(!n)throw Error("videoPixelValidator is required for video media type");return iS(i,r,n)}return iy(a)&&iI(t)?iP(i,r):iT(i,r)},iy=e=>"DESKTOP"===e,iI=e=>iE(e)>=242500,iE=e=>e.getBoundingClientRect().height*e.getBoundingClientRect().width,iS=(e,t,i)=>new t3(e.aaxInstrPixelUrl,e.loggingContext,ih.IAB_VIDEO,im(),t,ip(ih.IAB_VIDEO),i),iP=(e,t)=>new t3(e.aaxInstrPixelUrl,e.loggingContext,ih.IAB_LARGE_DISPLAY,im(),t,ip(ih.IAB_LARGE_DISPLAY)),iT=(e,t)=>new t3(e.aaxInstrPixelUrl,e.loggingContext,ih.IAB_DISPLAY,im(),t,ip(ih.IAB_DISPLAY)),iC=e=>{if(e.skAdNetwork)return new tJ(e.aaxImpPixelUrl,e.loggingContext,e.skAdNetwork)},iA=e=>{if(e.skAdNetwork)return new t9(e.aaxInstrPixelUrl,e.loggingContext,e.skAdNetwork,ih.SKAN,im(),ii(ic()))},ix="btr:impression";var ik=function(e,t){iM()&&iN(e+iD(t))},iM=function(){var e;return"function"==typeof(null==(e=null==window?void 0:window.ue)?void 0:e.tag)},iN=function(e){var t;return null==(t=null==window?void 0:window.ue)?void 0:t.tag(e)},iD=function(e){return e?":".concat(e):""};let iL=e=>{if(!(null==e?void 0:e.adCreativeMetaData)||!Object.keys(e.adCreativeMetaData).length){ik("noadrender"),R({adrender:"false"});return}ik("adrender"),ik("adrender:safeframe"),i_(e),iO(e),iF(e),iB(e)},i_=e=>{let t=iR(e);ik("adrender","creativetemplatename:"+t),R({adrender:"true",creativeTemplateName:t,isLightAds:"false"})},iR=e=>e.adCreativeMetaData.adCreativeTemplateName?e.adCreativeMetaData.adCreativeTemplateName.toLowerCase().replace(/[^0-9a-z]/g,""):"unknown",iO=e=>{e.adCreativeMetaData.adCreativeId&&(ik("adrender","creativeid:"+e.adCreativeMetaData.adCreativeId),R({creativeId:e.adCreativeMetaData.adCreativeId}))},iF=e=>{e.adCreativeMetaData.adProgramId&&(ik("adrender","programid:"+e.adCreativeMetaData.adProgramId),R({adProgramId:e.adCreativeMetaData.adProgramId}))},iB=e=>{void 0!==e.isCardsFlow&&R({isCardsFlow:e.isCardsFlow.toString()})},iV=e=>1004!==e&&eI().isT1(),iH=(e,t,i)=>{new IntersectionObserver((a,n)=>{a.forEach(async a=>{if(a.isIntersecting){var r;await t.impressionPixel.fire(e),i&&(null==(r=t.btrPixel)||r.fire(e)),t.measurabilityPixel.fire(e),n.disconnect()}})},{threshold:0}).observe(e.div)},iU=async e=>{if(e.firePixelsAfter&&await tp(e.firePixelsAfter,tI(e)),await tb(e),iV(Number(e.adCreativeMetaData.adProgramId)));else{var t;null==(t=ig(ai(e)))||t.fire({id:e.placementId,name:e.placementName,div:tI(e),deviceType:e.deviceType}),i$(e)}},i$=e=>{k(ix,{id:e.placementId,name:e.placementName},1),M(ix,1),M(ix+":program:"+(e.adCreativeMetaData.adProgramId?e.adCreativeMetaData.adProgramId:"unknown"),1),M(ix+":template:"+iR(e),1)},iz=(e,t)=>{m(t.message+": "+e.placementName,t.error),m(t.message,t.error)},iW=(e,t)=>{h(t.message+": "+e.placementName,t.error)},iJ=(e,t)=>{var i,a;let n=Error(t.message);null==(i=(a=window).ueLogError)||i.call(a,n,{logLevel:"ERROR",attribution:"sf-blank-ads",message:t.message+" | "})},iG={DESKTOP:16,MSHOP:10,MWEB:10},iq=e=>(null==e?void 0:e.length)>1&&"%"===e.charAt(e.length-1),iK=e=>iq(e)?e:`${parseInt(e)}px`,iY=(e,t="MWEB")=>{if(iq(e))return e;let i=parseFloat(e),a=iG[t];return i&&a?`${i/a}lh`:"inherit"},iX=(e,t)=>{let i=e=>iq(e)?e:parseInt(e);e_({metricName:"creative:size:changeSize",adDetails:e,additionalDimensions:{postSize:`${i(t.width)}x${i(t.height)}`}})},ij=(e,t)=>{c("ChangeSize API has been deprecated"),i0(e)&&iZ(e,t)&&iX(e,t)},iZ=(e,t)=>{if(!iQ(t))return m(`Size w:'${t.width}', h:'${t.height}' is not allow-listed for '${e.placementName}'`),!1;let i=tI(e);return i1(e,t)&&(i.style.maxHeight=iK(t.height)),iq(t.height)||iq(t.width)||"FIXED"===e.sizing?(i.style.width=iK(t.width),i.style.height=iK(t.height)):(i.removeAttribute("style"),i.style.aspectRatio=`${parseInt(t.width)} / ${parseInt(t.height)}`),!0},iQ=e=>{let t=iK(e.height),i=iK(e.width);return[{width:"100%",height:"169px"},{width:"300px",height:"250px"}].some(e=>t===e.height&&i===e.width)},i0=e=>{var t,i;return"hero-quick-promo"===e.slotName&&((null==(t=e.adCreativeMetaData)?void 0:t.adCreativeTemplateName)==="Personalized Responsive eCommerce"||!(null==(i=e.adCreativeMetaData)?void 0:i.adCreativeTemplateName))},i1=(e,t)=>"hero-quick-promo"===e.slotName&&iq(t.width),i2=(e,t)=>O(t.metricName,{name:e.placementName,id:e.placementId}),i3=async e=>{var t,i;let a=ai(e),n={id:e.placementId,name:e.placementName,div:tI(e),deviceType:e.deviceType};await (null==(t=iC(a))?void 0:t.fire(n)),null==(i=iA(a))||i.track(n)},i5="sfVideoContinuousPlaytimeSeconds",i9=e=>{var t,i;let a=0;return t=e.div,i=e=>{a=e.detail.sfVideoContinuousPlaytimeSeconds},t.addEventListener(i5,e=>{i(e)}),{shouldFirePixel:()=>a>=2}},i6=async(e,t)=>{let i=tI(e);await tp(e.firePixelsAfter,i),await tb(e);let a=ai(e),n={id:e.placementId,name:e.placementName,div:i,deviceType:e.deviceType};iV(Number(e.adCreativeMetaData.adProgramId))?iH(n,{impressionPixel:iv(a),btrPixel:ig(a),measurabilityPixel:iw(a)},t.isBtr):iw(a).fire(n),i3(e);let{iabViewPixel:r}=i4(a,e,n);iu.set(n,t.isBtr),r.track(n)},i4=(e,t,i)=>({iabViewPixel:ib(t.mediaType,i.div,e,t.deviceType,i7(t.mediaType,i))}),i7=(e,i)=>t(e)?i9(i):void 0,i8=new Set;class ae{constructor(e,t){this.hms=e,this.hc=t,this.expandInlineListeners=new Map,this.originalHeights=new Map,this.changeSize=ij,this.fireImpressionWithDelay=async e=>{await tE(this.hms,e)},this.logAPIInvocation=(e,t)=>{let i=`messenger:${t.apiName}`;M(i),k(i,{id:e.placementId,name:e.placementName})},this.logError=iz,this.logFatal=iW,this.logBlankAd=iJ,this.logCsaEvent=i2,this.sendLatencyMetric=(e,t)=>at(e,t),this.fireViewableLatencyMetrics=async(e,t)=>{tv(this.hc.viewableLatencyTrackers,e.arid,e.placementName,e.placementId,e.adUnitPlacementId,t.adLoadedTimestamp)},this.countMetric=(e,t)=>{t.isGlobal?M(t.metricMsg,t.value):k(t.metricMsg,{id:e.placementId,name:e.placementName},t.value)},this.requestVideoAutoplay=(e,t)=>{M("common:supported:command:requestVideoAutoplay"),tk(e,t,this.hms)},this.releaseVideoAutoplay=()=>{M("common:supported:command:releaseVideoAutoplay"),tM()},this.haveVideoAutoplayPermission=e=>{M("common:supported:command:haveVideoAutoplayPermission"),tN(e)},this.feedbackLabelRendered=e=>{eh(e)},this.feedbackOpenModal=e=>{eu(e)},this.collapseSlot=(e,t)=>{var i,a;if(null==(i=window.APE_SF)?void 0:i.collapsedPlacements.has(e.adUnitPlacementId))return void c("Slot already collapsed");eV(e).collapse(e,t),null==(a=window.APE_SF)||a.collapsedPlacements.add(e.adUnitPlacementId)},this.sendEventAddedCreative=async e=>{i8.has(e.placementId)||(e.firePixelsAfter&&await tp(e.firePixelsAfter,tI(e)),await tb(e),iv(ai(e)).fire({id:e.placementId,name:e.placementName,div:tI(e),deviceType:e.deviceType}),i8.add(e.placementId))},this.sendEventCreativeBeginToRender=iU,this.sendEventCreativeLoaded=async(e,t)=>{await i6(e,t)},this.resizeForImageOnlyTemplate=e=>tI(e).classList.add("is-image-oo"),this.sendSfVideoContinuousPlaytimeSeconds=(e,t)=>{let i=tI(e),a=new CustomEvent(i5,{detail:t});i.dispatchEvent(a)},this.expandInline=e=>{if(!eE().isT1()&&!eE().isT2()&&!eS().isT1())return void this.logError(e,{message:"expandInline called without weblab enabled"});let t=tI(e);if(!t)return;let i=t.style.height||getComputedStyle(t).height;this.originalHeights.set(e.adUnitPlacementId,i);let a=this.expandInlineListeners.get(e.adUnitPlacementId);a&&a.forEach(({type:e,callback:t})=>{window.removeEventListener(e,t)});let n=an(e.slotName)?"312px":"307px";t.style.transition="height 0.3s ease",t.style.setProperty("height",an(e.slotName)?n:iY(n),"important");let r=t=>{this.hms.sendMessageToAd(e.arid,"triggerEventInIframe",{eventType:t.type}),this.resetSlot(e)},l=["click","swipe","tap"].map(e=>({type:e,callback:r}));l.forEach(({type:e,callback:t})=>{window.addEventListener(e,t,{once:!0})}),this.expandInlineListeners.set(e.adUnitPlacementId,l)},this.resetSlot=e=>{if(!eE().isT1()&&!eE().isT2()&&!eS().isT1())return void this.logError(e,{message:"resetSlot called without weblab enabled"});let t=tI(e);if(!t)return;t.style.transition="height 0.3s ease";let i=this.originalHeights.get(e.adUnitPlacementId)||"55px";t.style.setProperty("height",an(e.slotName)?i:iY(i),"important"),this.originalHeights.delete(e.adUnitPlacementId)}}}let at=(e,{latencyMetricType:t,timestamp:i})=>{e9().sendLatencyMetric({latencyMetricType:t,placementName:e.placementName,placementId:e.placementId,placementDivId:e.adUnitPlacementId,timestamp:i})},ai=e=>{var t;return{aaxImpPixelUrl:e.aaxImpPixelUrl,aaxInstrPixelUrl:e.aaxInstrPixelUrl,abpAcceptable:e.abpAcceptable,abpStatus:null!=(t=e.abpStatus)?t:"-1",btrPixelUrl:e.btrPixelUrl,skAdNetwork:e.skAdNetwork,loggingContext:{aaxProgramId:Number(e.adCreativeMetaData.adProgramId)}}},aa=["desktop-detail-ilm","vindp-desktop-atf-ilm","fresh-desktop-detail-ilm","wfm-desktop-detail-ilm","alm-weis-desktop-detail-ilm","alm-save-desktop-detail-ilm","alm-lucky-desktop-detail-ilm","alm-bristol-desktop-detail-ilm","alm-rite-desktop-detail-ilm","alm-bartell-desktop-detail-ilm","alm-cardenas-desktop-detail-ilm","alm-petfoodexpress-desktop-detail-ilm","alm-allthebestpetcare-desktop-detail-ilm"],an=e=>aa.includes(e),ar="nav-cart",al=e=>{let t=document.documentElement,i=tI(e);as(t,i),new MutationObserver(e=>{for(let t of e)"attributes"===t.type&&"class"===t.attributeName&&as(t.target,i)}).observe(t,{attributes:!0,attributeFilter:["class"]})},as=(e,t)=>{if(e.classList.contains("nav-ewc-persistent-hover")){t.classList.add(ar);let e=ao();t.style.setProperty("--nav-cart-full-width",`${e}px`),t.style.setProperty("--nav-cart-half-width",`${e/2}px`)}else t.classList.remove(ar)},ao=()=>{var e;let t=document.querySelector("div#nav-flyout-ewc");return null!=(e=null==t?void 0:t.offsetWidth)?e:0},ad=Array.from({length:100},(e,t)=>(t+1)/100),ac=(e,t)=>{let i=tf(e);i&&new IntersectionObserver(i=>i.forEach(i=>am(e,t,i)),{threshold:ad}).observe(i)},am=(e,t,{target:i,intersectionRect:a,boundingClientRect:n,intersectionRatio:r})=>{let l=a.width/n.width,s=a.height/n.height;t.sendMessageToAd(e.arid,"populateSafeFrameExt",{geom:{self:{t:n.top,l:n.left,r:n.right,b:n.bottom,xiv:l,yiv:s,iv:r,z:1,w:i.offsetWidth,h:i.offsetHeight}},inViewPercentage:Math.round(100*r)})},ah=(e,t)=>{let i=tf(e);i&&setInterval(()=>{let a=i.getBoundingClientRect();t.sendMessageToAd(e.arid,"populateGeom",{geom:{self:{t:a.top,l:a.left,r:a.right,b:a.bottom,z:1,w:i.offsetWidth,h:i.offsetHeight}}})},250)},au="adplacements:retailClickTracking:failure",ap=async e=>{let t=document.getElementById(e);null==t||t.removeAttribute("onclick");let i=null==t?void 0:t.getAttribute("data-click-addr");if(!i)return void window.ue.count("adplacements:retailClickTracking:missingUrl",1);try{(await fetch(i,{keepalive:!0})).ok?window.ue.count("adplacements:retailClickTracking:clickSuccess",1):window.ue.count(au,1)}catch(e){window.ue.count(au,1)}},ag=e=>({onSafeFrameReady(t){var i,a;av("eventsChannel:onSafeFrameReady",t),null==(a=performance)||null==(i=a.mark)||i.call(a,`SafeFrame:  safeFrameReady ${t.slotName}`),e.sendMessageToAd(t.arid,"setupComputedAdDetails",{aPageStart:window.aPageStart,adStartTime:new Date().getTime()}),window.addEventListener("resize",()=>{e.sendCustomMessageToAd(t.arid,"resize",{height:window.innerHeight,width:window.innerWidth})}),iL(t),al(t),ac(t,e),ah(t,e)},onPreCreativeWrite(e){av("eventsChannel:onPreCreativeWrite",e);let t={id:e.placementId,name:e.placementName};k("adload:renderstart",t),O("adload_renderstart",t)},onPostCreativeWrite(e){av("eventsChannel:onPostCreativeWrite",e);let t={id:e.placementId,name:e.placementName};k("adload:renderend",t),O("adload_renderend",t)},onCreativeBeginToRender(e){av("eventsChannel:onCreativeBeginToRender",e)},onCreativeLoad(e){av("eventsChannel:onCreativeLoad",e);let t={id:e.placementId,name:e.placementName};k("adload:creativewritten",t),O("adload_creativewritten",t)},onError(e){av("eventsChannel:onError",e)},onClick(e){av("eventsChannel:onClick",e),ap(e.adUnitPlacementId)}}),av=(e,t)=>{M(e),k(e,{id:t.placementId,name:t.placementName},performance.now())},aw=()=>{let e=new g,t=new v(e.adMap),i=ag(t),a=new w(new ae(t,e),i);return new tm(e,a)},af=()=>{performance.mark("Safeframe: initSafeframeHostDesktop"),window.APE_SF||(performance.mark("Safeframe: initSafeframeHostDesktop init"),window.APE_SF=aw())};e(()=>af(),m,"Error initializing safeFrame")()})();
//# sourceMappingURL=DAsf-1.50.f431a298.js.map
