const e=()=>{window.dcmads=window.dcmads||{},window.dcmads.eids="4|40004007"},t="sfImpression",a="LightAdImpression",n="viewablelatency",i=(e,t,a)=>({csaKey:e,csmKey:t,csmMessage:a});i("bodyBegin","bb"),i("bodyBegin","bb",t),i("bodyBegin","bb",a);const r=i("bodyEnd","be");i("clickToATF","af");const o=i("criticalFeature","cf");i("criticalFeature","cf",t),i("criticalFeature","cf",a);const s=i("loaded","ld"),l=i("loaded","ld",t);i("loaded","ld",a),i("viewablelatency:bodyBegin","bb",n),i("viewablelatency:loaded","ld",n);const d=(e,t)=>{let a=()=>{var a,n;return null==e||null==(n=e.renderingWeblabs)||null==(a=n[t])?void 0:a.toLowerCase()};return{isT1:()=>"t1"===a(),isT2:()=>"t2"===a(),getTreatment:()=>a()}},c=()=>d(window,"ADPT_SF_LOW_RATE_METRIC_LOGGING_1256362"),m=()=>d(window,"ADPT_SF_HIGH_RATE_METRIC_LOGGING_1256364"),h=()=>d(window,"ADPT_SF_PIXEL_FIRING_1151992"),u=()=>d(window,"APM_STORES_JPS_JRS_SAFEFRAME_CLICK_TRACKING_PAINTER_TEST_1259727"),g=()=>d(window,"APM_STORES_JPS_JRS_SAFEFRAME_VIEW_RATE_EXPERIMENT_1289633"),p=()=>d(window,"ADPT_SF_EXTEND_REPLAY_TIMEOUT_1296395"),v=()=>d(window,"APM_STORES_JPS_JRS_SAFEFRAME_DISABLE_USER_AGENT_1326744"),w=()=>d(window,"APM_STORES_JPS_JRS_SAFEFRAME_DISABLE_POSTMESSAGE_1327371"),E="APE_CW_METRICS";let f=!1;const y=e=>{f||(window.addEventListener("beforeunload",()=>T()),f=!0);let t=M();t.push(e),t.length>=10?C(t):S(t)},M=()=>{let e=localStorage.getItem(E);if(!e)return[];try{return JSON.parse(e)}catch(e){return[]}},C=e=>{navigator.sendBeacon("https://qdbx3pbnx6veby23pzgaowu3q40tmmrr.lambda-url.us-east-1.on.aws",JSON.stringify(I(e))),localStorage.removeItem(E)},I=e=>({metrics:e,xApiKey:"aUAZqFtiIp6VxqpW3coqZ2JdZnV3RN9S8yKMRIdJ"}),S=e=>{localStorage.setItem(E,JSON.stringify(e))},T=()=>{let e=M();e.length>0&&C(e)},b=e=>{var t,a;if(!window.APE_SF)return;let n=null!=(a=(t=window.APE_SF).loggedMetricNames)?a:t.loggedMetricNames=new Set;n.has(e.metricName)||(n.add(e.metricName),y(e))},P=({metricName:e,adDetails:t,count:a=1,additionalDimensions:n={}})=>{m().isT1()&&y(_(e,a,R(t,n)))},A=({metricName:e,adDetails:t,count:a=1,additionalDimensions:n={},once:i=!1})=>{c().isT1()&&(i?b:y)(_(e,a,R(t,n)))},_=(e,t,a)=>({metricName:e,timestamp:new Date().getTime(),value:t,dimensions:a}),R=(e,t)=>{var a,n;return{app:"SF",siteName:e.siteName,slotName:e.slotName,pageType:e.pageType,placementId:e.placementId,mediaType:e.mediaType,programId:null==(a=e.adCreativeMetaData)?void 0:a.adProgramId,creativeTemplateName:null==(n=e.adCreativeMetaData)?void 0:n.adCreativeTemplateName,deviceType:e.deviceType,...t}},N="sf iframe ready",L=()=>{Object.defineProperty(Document.prototype,"cookie",{get:()=>"",set:()=>{}})},x=()=>{var e,t;(null==(t=window)||null==(e=t.navigator)?void 0:e.geolocation)&&(window.navigator.geolocation.watchPosition=(e,t,a)=>0,window.navigator.geolocation.getCurrentPosition=(e,t,a)=>{})},D=()=>{Object.defineProperty(Navigator.prototype,"userAgent",{get:()=>"",set:()=>{}})},F=e=>{let t=k(window.parent,e);Object.defineProperty(window,"parent",{value:new Proxy(window.parent,{get:(e,a)=>"postMessage"===a?t:e[a]})})},k=(e,t)=>{let a=!1;return(n,i,r)=>{if(n===N&&!a)return a=!0,e.postMessage(n,i,r);console.debug("postMessage blocked"),A({metricName:"postMessageBlocked",adDetails:t})}},z=(e,t)=>{console.error(e,t)},O=e=>{e.sendLatencyMetric(s),e.sendLatencyMetric(o)};var $,W,B=function(e){console.debug(e)},J=function(e,t){console.error(e,JSON.stringify(t)),V("ERROR",e,q(e,t))},U=function(e,t){console.error(e,JSON.stringify(t)),V("FATAL",e,q(e,t))},V=function(e,t,a){var n;null==(n=window.ueLogError)||n.call(window,a,{logLevel:e,attribution:"APE-safeframe",message:t+" | "})},q=function(e,t){return t instanceof Error?t:t?Error(t):Error(e)};const G=["amazon.com","amazon.in","amazon.de","amazon.co.jp","amazon.co.uk","amazon.ca","amazon.com.au","amazon.com.be","amazon.com.br","amazon.com.mx","amazon.com.tr","amazon.eg","amazon.es","amazon.fr","amazon.it","amazon.nl","amazon.pl","amazon.sa","amazon.se","amazon.sg","amazon.ae","amazon.co.za","amazon.cn","amazon.dev","boxofficemojo.com","a2z.com","console.harmony.a2z.com","depot.advertising.amazon.dev","harmony.a2z.com","d116tmsy8qpy37.cloudfront.net","d1u3onhraow3iz.cloudfront.net","d1ubtmbgqm1jlf.cloudfront.net","d2dk40qqpfbxei.cloudfront.net","d2jbcalcdp0p85.cloudfront.net","d2y0vsnh7zmbrq.cloudfront.net","d345aeerog89iv.cloudfront.net","imdb.com"],j=(e,t)=>t.some(t=>e.endsWith(t)),K=()=>{let e=document.referrer;if(!e)return!1;try{let t=new URL(e);return j(t.hostname,G)}catch(t){return J("Invalid referrer URL:",e),!1}},H="btr_client",X="cod_client",Z=e=>e.adCreativeMetaData.adCreativeTemplateName?e.adCreativeMetaData.adCreativeTemplateName.toLowerCase().replace(/[^0-9a-z]/g,""):"unknown",Q=(e,t,a)=>{if(""===t)throw Error("Invalid queryParamKey input to addJSONQueryParamToURL: "+JSON.stringify({queryParamKey:t}));let n=new URL(e),i=Object.assign(JSON.parse(n.searchParams.get(t)||"{}"),a);return n.searchParams.set(t,JSON.stringify(i)),n.toString()},Y=(e,t)=>{let a=document.createElement("img");return a.id=e,a.style.display="none",a.setAttribute("pixel-url",t),a},ee=(e,t,a)=>{let n=e+t;return a&&(n+="_"+a),n},et=e=>!!document.getElementById(e),ea=async(e,{pixelUrl:t,id:a,baseCounterName:n,baseMetricName:i,counterExtension:r,logId:o,aaxProgramId:s})=>{try{if(et(a))return!1;return e.logCsaEvent(ee(i,"fired",r)),e.countMetric(ee(n,"fired",r),1),await fetch(t,{keepalive:!0,mode:"no-cors",priority:"low"}),document.getElementsByTagName("body")[0].appendChild(Y(a,t)),e.countMetric(ee(n,"loaded",r),1),e.logCsaEvent(ee(i,"loaded",r)),e.countMetric(`pixel:${o}`,1,!0),s&&e.countMetric(`pixel:${o}:${s}`,1,!0),!0}catch(a){throw e.countMetric(ee(n,"error",r),1),e.logCsaEvent(ee(i,"error",r)),e.logError(`Error firing pixels: ${t}`,a),a}},en="impressionFired";var ei=function(e){return er(Array.from(e.querySelectorAll("img")).filter(function(e){return"none"!==getComputedStyle(e).display}))},er=function(e){return 0===e.length?{success:!1,code:"NO_CREATIVE"}:e.some(function(e){return e.complete&&e.naturalWidth>0&&e.naturalHeight>0})?{success:!0,code:"BEGIN_TO_RENDER"}:{success:!1,code:"ERROR"}};class eo{emitImpressionPixelMetrics(e){let t=this.o.adCreativeMetaData.adProgramId?this.o.adCreativeMetaData.adProgramId:"unknown",a=Z(this.o);this.c.countMetric(en,1,!0),this.c.countMetric(en+":program:"+t,1,!0),this.c.countMetric(en+":template:"+a,1,!0);let n=e?"btr:impression":"cod:impression";this.c.countMetric(n,1,!1),this.c.countMetric(n,1,!0),this.c.countMetric(n+":program:"+t,1,!0),this.c.countMetric(n+":template:"+a,1,!0)}constructor(e,t){this.c=e,this.o=t,this.fireCodImpressionPixel=async()=>{let e=!1;await ea(this.c,{id:"ape_impression",pixelUrl:es(this.o.aaxImpPixelUrl,"pj",X),baseCounterName:"adload:impression",baseMetricName:"impression",logId:"imp:cod",aaxProgramId:this.o.adCreativeMetaData.adProgramId})&&this.emitImpressionPixelMetrics(!1)}}}const es=(e,t,a)=>{let n=e.includes(".paets."),i=Q(e,t,{measurementMethod:a});return n?e:i},el=async(e=document.body)=>{let t=0;return new Promise(a=>{let n=setInterval(()=>{t+=5,ei(e).success?(clearInterval(n),a(H)):t>=75&&(clearInterval(n),a(X))},5)})},ed=e=>{var t;return null==(t=document.getElementById(ey))?void 0:t.setAttribute(e,"true")},ec=e=>{let t=`ProgramId: ${e.adCreativeMetaData.adProgramId}, CreativeId: ${e.adCreativeMetaData.adCreativeId}, AdId: ${e.adCreativeMetaData.adId}, Template: ${e.adCreativeMetaData.adCreativeTemplateName}`,a=em(e.htmlContentEncodedLength);return`${t} (html size: ${a})`},em=e=>void 0===e?"N/A":0===e?"0":e<=5e3?"0<x<=5k":e<=1e5?"5k<x<=100k":">100k",eh=(e,t)=>{let a=setInterval(async()=>{var n,i;if("function"==typeof(null==(i=window)||null==(n=i.crv)?void 0:n.detectAndReportBlankAd)){clearInterval(a);try{await window.crv.detectAndReportBlankAd(document.body)?(t.countMetric("blankadvalidation:failure",1,!0),t.logBlankAd(`Blank ad detected. ${ec(e)}`)):t.countMetric("blankadvalidation:success",1,!0)}catch(e){t.countMetric("blankadvalidation:error",1,!0)}}},1e3)},eu=e=>e/window.innerWidth>=.95,eg=()=>{var e;return(null!=(e=document.documentElement.innerText)?e:"").replace(/\s/g,"").length>75},ep=e=>e.some(e=>e.classList.contains("ad-background-image")),ev=e=>{for(let t of e)if(eu(t.getBoundingClientRect().width))return!0;return!1},ew=()=>{let e=Array.from(document.querySelectorAll("img"));return!!e.length&&(!!ep(e)||!(!ev(e)||eg()))},eE=e=>{ew()&&e.sendMessage("resizeForImageOnlyTemplate")},ef=e=>1004!==e&&g().isT1(),ey="creativeReplayStatus",eM="creativeReplayComplete",eC=`document.dispatchEvent(new CustomEvent("${eM}"));`,eI=()=>`<script id="${ey}">${eC}</script>`,eS=e=>{var t,a;let n=document.createRange();n.selectNode(e);let i=n.createContextualFragment(e.outerHTML).firstElementChild;if(i.getAttribute("src"))i.async=!1;else{let t=e.innerHTML;i.async=!1,i.setAttribute("src",`data:text/javascript;charset=UTF-8,${encodeURIComponent(t)}`)}null==(t=e.parentNode)||t.insertBefore(i,e.nextSibling),null==(a=e.parentNode)||a.removeChild(e)},eT=e=>{if(void 0==document.documentElement){let e=document.createElement("html");document.appendChild(e)}document.documentElement.innerHTML=e},eb=e=>{for(let t of e.querySelectorAll("script"))eS(t)},eP=(e,t,a,n,i)=>{n.onPreCreativeWrite(a),h().isT1()?e.sendMessage("sendEventAddedCreative"):i.hasFiredCODPixel||(ef(Number(a.adCreativeMetaData.adProgramId))||(a.firePixelsAfter?e.sendMessage("fireImpressionWithDelay"):t.fireCodImpressionPixel()),i.hasFiredCODPixel=!0)},eA=async(e,t,a,n,i)=>{eR(),e_();let r=e.btrPixelUrl?await el():X;i.onCreativeBeginToRender(e);let o=r===H;o&&t.sendMessage("sendEventCreativeBeginToRender"),t.sendMessage("sendEventCreativeLoaded",{isBtr:o}),eL(),eh(e,n),eN(e)&&eE(t)},e_=()=>{ed("creativeLoad"),eY()},eR=()=>{ed("creativedomcontentloaded"),document.dispatchEvent(new Event("DOMContentLoaded"))},eN=e=>{var t;return["mweb","mshop"].includes(null==(t=e.deviceType)?void 0:t.toLowerCase())},eL=()=>{document.addEventListener("touchstart",{handleEvent:()=>{}},!1)},ex=new RegExp(/((&#\d{2,4};)|(&[a-z]{2};)|(&[a-z]{3,7};)|(%[a-fA-F0-9]{2})|(\W))pd_rd_plhdr(=|%3D)t((&#\d{2,4};)|(&[a-z]{2,7};)|(%[a-fA-F0-9]{2})|(\W))/),eD=(e,t)=>{let a=t,n=e;if("&pd_rd_plhdr=t"===e||""===e.trim())return a;(n=n.replace(/&amp;/g,"&")).startsWith("&")&&(n=n.replace(/^&+/,"")),n.endsWith("&")&&(n=n.replace(/&+$/,""));try{let e,t=0;do{if(t++,!(e=a.match(ex)))break;let i=e[1],r=e[8],o=e[7],s=i.startsWith("&")&&i.endsWith(";")||r.startsWith("&")&&r.endsWith(";"),l=i.startsWith("%")&&r.startsWith("%")&&"%3D"===o;a=s?a.replace(ex,"$1"+n.replace(/&/g,"&amp;")+"$8"):l?a.replace(ex,"$1"+encodeURIComponent(n)+"$8"):a.replace(ex,"$1"+n+"$8")}while(e&&t<10)}catch(e){return t}return a},eF=500,ek=async(e,t=eF)=>new Promise(a=>{let n=-1,i=e=>{let t=e.data,i="percolateClickTracking";if(t.command!==i)throw Error(`Unexpected command ${t}, Expected ${i}`);window.clearTimeout(n),a(t.data)};n=window.setTimeout(()=>{e.removeEventListener("message",i),a(""),B(`Did not receive percolateClickTracking within ${t}ms`)},t),e.addEventListener("message",i,{once:!0}),e.start()});class ez extends Error{}const eO=(e,t)=>{let{onReport:a=()=>{}}=t;if(void 0!==window.ReportingObserver){let t=(t=[])=>{let n=e$(e);t.forEach(e=>{"intervention"===e.type&&a(new ez(JSON.stringify({adDetails:n,report:e.toJSON()})))})},n=new ReportingObserver(t,{buffered:!0});n.observe(),document.addEventListener("pagehide",()=>{t(n.takeRecords())})}},e$=e=>{let{adCreativeMetaData:t,slotName:a,placementId:n,placementName:i,pageType:r}=e;return{adCreativeMetaData:t,slotName:a,placementId:n,placementName:i,pageType:r}},eW=e=>eB(e),eB=e=>decodeURIComponent(escape(atob(e))),eJ=e=>{if(!e.htmlContentEncoded||0===e.htmlContentEncoded.trim().length)throw Error("No html content found on a server side fetch");let t=e.htmlContentEncodedLength?e.htmlContentEncoded:eW(e.htmlContentEncoded);return eU(t,e.htmlContentEncodedLength),t},eU=(e,t)=>{t&&e.length!==t&&console.debug(`Mismatched expected htmlContentEncoded size. Expected ${t} but got ${e.length}`)},eV={win:{t:0,b:0,l:0,r:0,w:0,h:0},self:{t:0,l:0,r:0,b:0,xiv:0,yiv:0,iv:0,z:0,w:0,h:0},exp:{t:0,l:0,r:0,b:0,xs:0,yx:0}},eq=((e=-1)=>{let t=e;return{set(e){t=e},get:()=>t}})(),eG=((e=eV)=>({set(t){e.self={...e.self,...t.self}},get:()=>e}))(),ej=()=>({ext:{inViewPercentage:()=>eq.get(),geom:()=>eG.get()}}),eK=async e=>{let t=eH();eX(e,eI()),await t},eH=()=>new Promise((e,t)=>{if(document.addEventListener(eM,()=>e(),{once:!0}),!p().isT2()){let e=p().isT1()?15:5;setTimeout(()=>t(Error(`${eM} timeout after ${e} seconds`)),1e3*e)}}),eX=(...e)=>{let t=e.filter(e=>!!e).map(String).join("");if(null!==document.currentScript){let e=document.currentScript;for(e.insertAdjacentHTML("afterend",t),e=e.nextElementSibling;null!==e;)"SCRIPT"===e.tagName?eS(e):eb(e),e=e.nextElementSibling}else eT(t),eb(document.documentElement)};class eZ{constructor(e,t,a,n,i,o){this.o=e,this.mp=t,this.cms=a,this.cmr=n,this.c=i,this.eventsChannel=o,this.state={hasFiredCODPixel:!1},this.clickTrackingParam="",this.logInterventionReport=e=>{P({metricName:"reporting-observer:heavy-ad-intervention",adDetails:this.o,additionalDimensions:{creativeId:this.o.adCreativeMetaData.adCreativeId}}),this.c.logFatal("heavy-ad-intervention",e)},this.initSFClient=async({timeout:e=eF}={})=>{this.ensureGlobals(),L(),x(),v().isT1()&&D(),document.write=eX,this.c.sendLatencyMetric(r),this.eventsChannel.onSafeFrameReady(this.o),u().isT1()||(this.clickTrackingParam=await ek(this.mp,e)),this.mp.onmessage=this.cmr.receiveMessage,this.c.countMetric("adload:iframeinitialized",1),this.c.logCsaEvent("adload_iframeinitialized"),await this.writeCreativeToDocument()},this.writeCreativeToDocument=async()=>{eQ(this,this.o);let e=p().isT1()?"T1":p().isT2()?"T2":"C";try{var t;let a=eD(this.clickTrackingParam,eJ(this.o));eP(this.cms,this.c.cr,this.o,this.eventsChannel,this.state),await eK(a),this.c.logAPIInvocation(`creativeReplayComplete_${e}`),this.eventsChannel.onPostCreativeWrite(this.o),await eA(this.o,this.cms,this.c.cr,this.c,this.eventsChannel),this.eventsChannel.onCreativeLoad(this.o),u().isT1()&&document.body.addEventListener("click",()=>{this.eventsChannel.onClick(this.o)},{once:!0}),(null==(t=window.renderingWeblabs)?void 0:t.APM_STORES_JPS_JRS_CREATIVE_BOOKS_ADS_1277965)&&this.c.countMetric("bookAdsWeblabTriggered",1,!0)}catch(t){this.c.logError("Failed to get creative content",t),this.c.collapseSlotInternal("CLIENTSETUP"),this.c.logAPIInvocation(`collapseSlotCLIENTSETUP_${e}`),this.eventsChannel.onError(this.o)}},this.ensureGlobals=()=>{var e;window.onerror=this.handleErrors,window.$sf=null!=(e=window.$sf)?e:ej(),window.aaxInstrPixelUrl=this.o.aaxInstrPixelUrl},this.handleErrors=(e,t,a,n,i)=>{let r=i||Error(e.toString());return(null==t?void 0:t.startsWith("chrome-extension://"))||(null==t?void 0:t.startsWith("moz-extension://"))?this.c.logAPIInvocation("sfBrowserExtensionError"):(this.c.logError(`Window.onerror triggered inside of the iframe. Src: ${t}:${a}:${n}`,r),ei(document.body).success||this.c.collapseSlotInternal("CLIENTERROR"),this.eventsChannel.onError(this.o)),!0};let s=document.open.bind(document);document.open=(...e)=>{let t=s(...e);return this.ensureGlobals(),t},this.nativeWrite=document.write.bind(document),window.onerror=this.handleErrors,eO(this.o,{onReport:this.logInterventionReport})}}const eQ=(e,t)=>{t.creativeSupportsTTIMeasurement||window.addEventListener("load",()=>O(e.c),{once:!0}),window.addEventListener("load",()=>e.c.fireViewableLatencyMetrics(),{once:!0})},eY=()=>{window.dispatchEvent(new Event("load"))};class e0{constructor(e,t,a){this.cms=e,this.o=t,this.mL=a,this.fireImpression=async e=>{this.sendLatencyMetric(l),await this.cr.fireCodImpressionPixel()},this.changeSize=(e,t)=>{this.cms.sendMessage("changeSize",{width:e,height:t})},this.logCsaEvent=e=>{this.cms.sendMessage("logCsaEvent",{metricName:e})},this.registerCustomMessageListener=(e,t)=>{this.mL[e]=t,this.countMetric("sf:commonmain:registerCustomMessageListener",1,!0)},this.sendLatencyMetric=e=>{this.cms.sendMessage("sendLatencyMetric",{latencyMetricType:e,timestamp:new Date})},this.countMetric=(e,t=1,a=!1)=>{this.cms.sendMessage("countMetric",{metricMsg:e,value:t,isGlobal:a})},this.fireViewableLatencyMetrics=()=>{this.cms.sendMessage("fireViewableLatencyMetrics",{adLoadedTimestamp:Date.now()})},this.feedbackLabelRendered=()=>{this.cms.sendMessage("feedbackLabelRendered")},this.feedbackOpenModal=()=>{this.cms.sendMessage("feedbackOpenModal")},this.updatePlayingTimeForVideo=e=>{this.cms.sendMessage("sendSfVideoContinuousPlaytimeSeconds",{sfVideoContinuousPlaytimeSeconds:e})},this.requestVideoAutoplay=()=>{this.cms.sendMessage("requestVideoAutoplay")},this.releaseVideoAutoplay=()=>{this.cms.sendMessage("releaseVideoAutoplay")},this.haveVideoAutoplayPermission=()=>{this.cms.sendMessage("haveVideoAutoplayPermission")},this.isOnAmazon=()=>!0,this.logError=(e,t,a)=>{this.cms.sendMessage("logError",{message:e,error:t,level:a})},this.logFatal=(e,t,a)=>{this.cms.sendMessage("logFatal",{message:e,error:t,level:a})},this.logBlankAd=(e,t,a)=>{this.cms.sendMessage("logBlankAd",{message:e,error:t,level:a})},this.collapseSlotInternal=e=>{this.logAPIInvocation("collapseSlot"),this.logAPIInvocation(`collapseSlot${e}`),this.cms.sendMessage("collapseSlot",e)},this.collapseSlot=()=>{this.collapseSlotInternal("CREATIVE")},this.resizeCreativeWrapper=e=>{let t=window.document.getElementById(`ape_${this.o.scope}_creativeWrapper`);null!==t&&(t.style.height=e.height,t.style.width=e.width)},this.triggerEventInIframe=e=>{window.dispatchEvent(new Event("outerpage"+e.eventType))},this.logAPIInvocation=(e,...t)=>{this.cms.sendMessage("logAPIInvocation",{apiName:e,apiParams:t}),this.cms.sendMessage("logCsaEvent",{metricName:"messenger_"+e})},this.setupComputedAdDetails=e=>{window.aPageStart=e.aPageStart,window.adStartTime=e.adStartTime},this.signalAdLoadedAndInteractive=()=>{O(this)},this.sendEventAddedCreative=()=>{this.cms.sendMessage("sendEventAddedCreative")},this.populateGeom=e=>eG.set(e.geom),this.populateSafeFrameExt=e=>{eq.set(e.inViewPercentage),eG.set(e.geom)},this.expandInline=()=>{this.logAPIInvocation("expandInline"),this.cms.sendMessage("expandInline")},this.resetSlot=()=>{this.logAPIInvocation("resetSlot"),this.cms.sendMessage("resetSlot")},this.cr=new eo(this,t)}}class e1{constructor(e,t){this.o=e,this.messagePort=t,this.sendMessage=(e,t)=>{let a={command:e,adDetails:this.o,payload:t||{}};try{this.messagePort.postMessage(a)}catch(e){z("Post Message error",e)}}}}class e2{constructor(e,t,a){this.c=e,this.o=t,this.mL=a,this.pendingMessages=new Map,this.waitForMessageProcessed=async e=>new Promise(t=>this.pendingMessages.set(e,t)),this.receiveMessage=e=>{try{let t=e.data,a=t.command?t.command.split("."):[],n=this.c[a[0]];for(let e=1;e<a.length;e++)if(n)n=n[a[e]];else break;if("customMessage"===t.command){let e=t.data.key,a=t.data.data;if("function"==typeof this.mL[e])try{this.mL[e](a)}catch(e){this.c.logError("Custom Message Listener Error",e)}}else n&&(n(t.data),e3(t.command,this.pendingMessages))}catch(t){this.c.logError("Error with "+e.data.command,t);return}}}}const e3=(e,t)=>{let a=null==t?void 0:t.get(e);null==a||a(),null==t||t.delete(e)};class e5 extends e0{constructor(e,t,a){super(e,t,a),this.isSupported=()=>!0,this.getARID=()=>this.o.arid,this.sendAdInfo=e=>{e&&this.o.adCreativeMetaData&&(this.o.adCreativeMetaData=e)},this.getPlacementInfo=()=>(this.logAPIInvocation("getPlacementInfo"),{slot:this.o.placementName,slotName:this.o.slotName,pageType:this.o.pageType})}}const e7=e=>({onSafeFrameReady:t=>e9(e,"onSafeFrameReady",t),onPreCreativeWrite:t=>e9(e,"onPreCreativeWrite",t),onPostCreativeWrite:t=>e9(e,"onPostCreativeWrite",t),onCreativeBeginToRender:t=>e9(e,"onCreativeBeginToRender",t),onCreativeLoad:t=>e9(e,"onCreativeLoad",t),onError:t=>e9(e,"onError",t),onClick:t=>e9(e,"onClick",t)}),e9=(e,t,a)=>{try{e.postMessage({command:t,adDetails:a,payload:{}})}catch(e){z("Post Message error",e)}},e4=(e,t)=>{let a=new e1(e,t),n={},i=new e5(a,e,n),r=new e2(i,e,n),o=e7(t);return new eZ(e,t,a,r,i,o)},e6=async(t,a,n)=>{try{var i,r,o;e(),window.renderingWeblabs=JSON.parse(null!=(o=n.weblabTreatments)?o:""),null==(r=performance)||null==(i=r.mark)||i.call(r,"SafeFrame: SF received ad details"),w().isT1()&&F(n);let s=t(a,n);try{s.initSFClient()}catch(e){s.c.logError("Could not init SafeFrame Client",e)}}catch(e){z("Could not init ",e)}},e8=e=>{var t,a;null==(a=performance)||null==(t=a.mark)||t.call(a,`SafeFrame: Start Send Ready ${e}`);try{window.parent.dispatchEvent(new MessageEvent("message",{source:window,origin:window.location.origin,ports:[e],data:N}))}catch(t){window.parent.postMessage(N,"*",[e])}},te=()=>""!==window.name?JSON.parse(window.name):null;null==(W=performance)||null==($=W.mark)||$.call(W,"SafeFrame: Enter sf.ts"),window.SFClient||(e=>{if("null"!==window.origin&&!K())return U(`Referrer not allowed: ${document.referrer}`);let t=te();if(t){let a=new MessageChannel;e6(e,a.port1,t),e8(a.port2)}else J("Ad Details not found in name!")})((e,t)=>{let a=e4(t,e);return window.SFClient=a.c,a});
//# sourceMappingURL=sf-1.50.8ad8524e.js.map
